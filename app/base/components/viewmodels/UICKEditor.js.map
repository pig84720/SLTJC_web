{"version":3,"file":"UICKEditor.js","sources":["../../utils/Common.js","UICKEditor.js"],"names":[],"mappings":"AAAA,OAAA,YAAA,WACA,GAAA,GAAA,SAAA,GACA,EAAA,IAAA,EAAA,SAAA,GACA,GAAA,GAAA,SAAA,cAAA,OAKA,IAJA,EAAA,KAAA,WACA,EAAA,IAAA,aACA,EAAA,KAAA,EAAA,IACA,EAAA,GAAA,EAAA,GACA,EAAA,SAAA,CACA,GAAA,GAAA,SAAA,cAAA,WACA,GAAA,YAAA,GACA,SAAA,qBAAA,QAAA,GAAA,YAAA,OAEA,UAAA,qBAAA,QAAA,GAAA,YAAA,MAKA,EAAA,SAAA,GACA,EAAA,IAAA,EAAA,SAAA,GACA,GAAA,GAAA,SAAA,cAAA,SACA,GAAA,KAAA,kBACA,EAAA,IAAA,EAAA,IACA,EAAA,GAAA,EAAA,GACA,SAAA,qBAAA,QAAA,GAAA,YAAA,MAGA,EAAA,SAAA,GACA,IACA,GAAA,GAAA,EAAA,MAAA,KAAA,GAAA,MAAA,KACA,EAAA,EAAA,MAAA,KAAA,GAAA,MAAA,KAGA,EAAA,GAAA,MACA,SAAA,EAAA,IACA,SAAA,EAAA,IAAA,EACA,SAAA,EAAA,IACA,SAAA,EAAA,IACA,SAAA,EAAA,IAEA,OAAA,GACA,MAAA,GACA,MAAA,QAGA,EAAA,SAAA,GACA,MAAA,OAAA,EACA,IAEA,KAAA,GAAA,EAAA,cACA,MAAA,IAAA,EAAA,WAAA,GACA,GAAA,MAAA,SACA,MAAA,IAAA,OAEA,IAAA,GAAA,EAAA,UACA,GAAA,IAAA,SACA,IAAA,IAAA,KAEA,KAAA,GAAA,EAAA,WACA,GAAA,KAAA,SACA,KAAA,IAAA,MAEA,OAAA,GAAA,EAAA,aACA,GAAA,OAAA,SACA,OAAA,IAAA,QAEA,OAAA,GAAA,EAAA,aACA,GAAA,OAAA,SACA,OAAA,IAAA,QAEA,KAAA,IAAA,MAAA,IAAA,IAAA,IAAA,KAAA,IAAA,OAAA,IAAA,SAIA,EAAA,SAAA,EAAA,GACA,MAAA,GAAA,GAAA,OAAA,EAAA,IAAA,QAAA,IAAA,GAAA,QAAA,IAAA,IAEA,EAAA,SAAA,GACA,IACA,GAAA,EAAA,GAAA,QAAA,OAAA,mBAAA,GAAA,YAAA,KAAA,SAAA,QACA,MAAA,oBAAA,EAAA,IACA,MAAA,GACA,MAAA,QAGA,EAAA,SAAA,GACA,GAAA,GAAA,OAAA,WAAA,EAAA,OAAA,WAAA,OAAA,MACA,EAAA,OAAA,YAAA,EAAA,OAAA,YAAA,OAAA,MAIA,OAHA,QAAA,SACA,EAAA,SAAA,KAAA,YAAA,EAAA,SAAA,KAAA,YAAA,IAGA,MAAA,EAAA,EACA,OAAA,EAAA,IAGA,EAAA,SAAA,GACA,EAAA,EAAA,QAAA,OAAA,OAAA,QAAA,OAAA,MACA,IAAA,GAAA,GAAA,QAAA,SAAA,EAAA,aACA,EAAA,EAAA,KAAA,SAAA,OACA,OAAA,OAAA,EAAA,GAAA,mBAAA,EAAA,GAAA,QAAA,MAAA,OAEA,EAAA,SAAA,GACA,GAAA,GAAA,EAAA,OAAA,MAAA,cAAA,SAAA,WAAA,OAAA,OAAA,YACA,GAAA,SACA,UAAA,GACA,MAEA,EAAA,SAAA,GACA,GAAA,GAAA,EACA,GAAA,eAAA,KAAA,SAAA,EAAA,GAEA,GAAA,GAAA,EAAA,GAAA,KAAA,aACA,QAAA,MAAA,IACA,QAAA,YAAA,IACA,QAAA,oBAAA,IACA,QAAA,kBAAA,IACA,QAAA,eAAA,IACA,QAAA,kBAAA,IACA,QAAA,IAAA,IACA,QAAA,IAAA,IACA,MAAA,IACA,GAAA,IAAA,EAAA,SAAA,GAEA,GAAA,GAAA,EAAA,MAAA,MACA,SAAA,EAAA,IAAA,UAAA,EAAA,IAAA,YAAA,EAAA,IAAA,SAAA,EAAA,IAAA,YAAA,EAAA,IAAA,WAAA,EAAA,MACA,YAAA,EAAA,GACA,IAAA,EAAA,QAAA,IAAA,EAAA,GAAA,OACA,GAAA,IAAA,EAAA,GAAA,KAAA,EAAA,GAAA,QAAA,IAAA,IAAA,KAGA,IAAA,EAAA,QAAA,IAAA,EAAA,GAAA,OACA,GAAA,IAAA,EAAA,GAAA,KAAA,EAAA,GAAA,UAMA,EAAA,EAAA,QAAA,MAAA,GAEA,IAAA,KACA,GAAA,IAAA,EAAA,OAAA,GAAA,MAAA,KAAA,SAAA,GACA,GAAA,GAAA,EAAA,MAAA,IAEA,QAAA,EAAA,IACA,IAAA,QAEA,EAAA,EAAA,IAAA,GAAA,WADA,EAAA,GAAA,QAAA,OAAA,GACA,IAEA,GAEA,MACA,KAAA,UACA,EAAA,EAAA,IAAA,GAAA,YAAA,EACA,MACA,KAAA,SACA,EAAA,EAAA,IAAA,GAAA,YAAA,EACA,MACA,KAAA,WACA,EAAA,EAAA,IAAA,GAAA,YAAA,EACA,MACA,KAAA,QACA,EAAA,EAAA,IAAA,WACA,MAAA,GAAA,EAAA,IAAA,GAEA,MACA,KAAA,WACA,EAAA,EAAA,IAAA,WAKA,KAAA,GAAA,KAAA,GAEA,EAAA,GAAA,EAAA,EAEA,OAAA,IAEA,EAAA,SAAA,EAAA,GACA,IAAA,GAAA,KAAA,GACA,MAAA,EAAA,KACA,EAAA,GAAA,EAAA,IAIA,QACA,QAAA,EACA,WAAA,EACA,iBAAA,EACA,eAAA,EACA,WAAA,EACA,WAAA,EACA,MAAA,EACA,mBAAA,EACA,UAAA,EACA,aAAA,EACA,cAAA,KCjMA,OAAA,yCAAA,UAAA,UAAA,SAAA,GACA,GAAA,GACA,EAAA,EAAA,SAKA,OAJA,GAAA,UACA,GAAA,cACA,IAAA,GAAA,IAAA,QAAA,8DAGA,KAAA,SAAA,EAAA,GACA,EAAA,EAAA,UAEA,GAAA,YAAA,WACA,SAAA,IAAA,IAAA,SAAA,IAAA,QAAA,GACA,SAAA,MAAA,oBAAA,SAQA,IAAA,GAAA,EAAA,QAGA,GAAA,aAAA,cACA,EAAA,UAAA,GAAA,QAAA,QAAA,sBAEA,EAAA,0BAAA,GAAA,QAAA,QAAA,qBACA,KAAA,GAAA,KAAA,GACA,SAAA,OAAA,GAAA,EAAA,EAGA,IAAA,GAAA,WA0BA,QAAA,KAGA,MAAA,SAAA,SAAA,UACA,IAGA,SAAA,QAAA,IAAA,eAhCA,GAAA,GAAA,IACA,IAAA,SAAA,QAAA,IAAA,SAEA,OAAA,YACA,GAAA,GAAA,SAAA,SAAA,QAAA,EAAA,KAEA,IACA,EAAA,QACA,+EAMA,EACA,SAAA,QAAA,EAAA,OAEA,EAAA,aAAA,kBAAA,QACA,SAAA,OAAA,EAAA,UAkBA,KAEA,SAAA,UAAA,EAAA,MAAA,GAAA,SAAA,WAEA,EAAA,SAAA,UAAA,EAAA,MAAA,eAKA,EAAA,UAAA,SAAA,GACA,GAAA,SAAA,UAAA,EAAA,MAAA,WACA,SAAA,UAAA,EAAA,MAAA,QAAA,MAIA,iBAAA,SAAA,EAAA,GAKA,MAJA,GAAA,KACA,WAAA,WACA,EAAA,UAAA,UAAA,EAAA,EAAA,eAAA,MAAA,SACA,KACA","sourcesContent":["define('Common',[],function () {\n    var loadCss = function (url) {\n            $.map(url, function (item, index) {\n                var link = document.createElement(\"link\");\n                link.type = \"text/css\";\n                link.rel = \"stylesheet\";\n                link.href = item.uri;\n                link.id = item.id;\n                if (item.noscript) {\n                    var noscript = document.createElement(\"noscript\");\n                    noscript.appendChild(link);\n                    document.getElementsByTagName(\"head\")[0].appendChild(noscript);\n                } else {\n                    document.getElementsByTagName(\"head\")[0].appendChild(link);\n                }\n                //console.log(link);\n            });\n        },\n        loadScript = function (url) {\n            $.map(url, function (uri, index) {\n                var scriptblock = document.createElement(\"script\");\n                scriptblock.type = \"text/javascript\";\n                scriptblock.src = uri.uri;\n                scriptblock.id = uri.id;\n                document.getElementsByTagName(\"head\")[0].appendChild(scriptblock);\n            });\n        },\n        dateStringToDate = function (dateString) {\n            try {\n                var scheduledDateArray = dateString.split('T')[0].split('-');\n                var scheduledTimeArray = dateString.split('T')[1].split(':');\n                //console.log(scheduledDateArray);\n                //console.log(scheduledTimeArray);\n                var scheduledTime = new Date(\n                    parseInt(scheduledDateArray[0]),\n                    parseInt(scheduledDateArray[1]) - 1,\n                    parseInt(scheduledDateArray[2]),\n                    parseInt(scheduledTimeArray[0]),\n                    parseInt(scheduledTimeArray[1])\n                );\n                return scheduledTime;\n            } catch (e) {\n                return null;\n            }\n        },\n        getDateTimeSTR = function (now) {\n            if (now == null) {\n                return '';\n            } else {\n                year = \"\" + now.getFullYear();\n                month = \"\" + (now.getMonth() + 1);\n                if (month.length == 1) {\n                    month = \"0\" + month;\n                }\n                day = \"\" + now.getDate();\n                if (day.length == 1) {\n                    day = \"0\" + day;\n                }\n                hour = \"\" + now.getHours();\n                if (hour.length == 1) {\n                    hour = \"0\" + hour;\n                }\n                minute = \"\" + now.getMinutes();\n                if (minute.length == 1) {\n                    minute = \"0\" + minute;\n                }\n                second = \"\" + now.getSeconds();\n                if (second.length == 1) {\n                    second = \"0\" + second;\n                }\n                return year + \"-\" + month + \"-\" + day + \" \" + hour + \":\" + minute + \":\" + second;\n            }\n        },\n    //取得傳入日期物件的字串格式\n        getDateSTR = function (now, ReplaceStr) {\n            return getDateTimeSTR(now).substr(0, 10).replace('-', ReplaceStr).replace('-', ReplaceStr);\n        },\n        getRequest = function (name) {\n            try {\n                if (name = (new RegExp('[?&]' + encodeURIComponent(name) + '=([^&]*)')).exec(location.search))\n                    return decodeURIComponent(name[1]);\n            } catch (e) {\n                return null;\n            }\n        },\n        getWH = function (unit) {\n            var width = (window.innerWidth > 0) ? window.innerWidth : screen.width;\n            var height = (window.innerHeight > 0) ? window.innerHeight : screen.height;\n            if (window.parent) {\n                width = (document.body.offsetWidth > 0) ? document.body.offsetWidth : width;\n            }\n            return {\n                width: width + unit,\n                height: height + unit\n            };\n        },\n        getParameterByName = function (name) {\n            name = name.replace(/[\\[]/, \"\\\\[\").replace(/[\\]]/, \"\\\\]\");\n            var regex = new RegExp(\"[\\\\?&]\" + name + \"=([^&#]*)\"),\n                results = regex.exec(location.search);\n            return results == null ? \"\" : decodeURIComponent(results[1].replace(/\\+/g, \" \"));\n        },\n        scrollTop = function (top) {\n            var $body = (window.opera) ? (document.compatMode == \"CSS1Compat\" ? $('html') : $('body')) : $('html,body');\n            $body.animate({\n                scrollTop: top\n            }, 2000);\n        },\n        genViewModel = function (base) {\n            var strVM = '';\n            $('[data-bind]').each(function (index, object) {\n                //console.log('{'+$(object).attr('data-bind')+'}');\n                var attrAry = $(object).attr('data-bind')\n                    .replace(/ /ig, '')\n                    .replace('jqxInput:', '')\n                    .replace('jqxDateTimeInput:', '')\n                    .replace('jqxNumberInput:', '')\n                    .replace('jqxCheckBox:', '')\n                    .replace('jqxRadioButton:', '')\n                    .replace('{', '')\n                    .replace('}', '')\n                    .split(',');\n                $.map(attrAry, function (obj, index) {\n                    //console.log(obj);\n                    var attr = obj.split(':');\n                    if (attr[0] == 'value' || attr[0] == 'enable' || attr[0] == 'disabled' || attr[0] == 'click' || attr[0] == 'ddlPromt' || attr[0] == 'checked') {\n                        if (attr[0] == 'disabled') {\n                            if (strVM.indexOf('\"' + attr[1] + '\"') == -1) {\n                                strVM += ',' + attr[0] + ':\"' + attr[1].replace('!', '') + '\"';\n                            }\n                        } else {\n                            if (strVM.indexOf('\"' + attr[1] + '\"') == -1) {\n                                strVM += ',' + attr[0] + ':\"' + attr[1] + '\"';\n                            }\n                        }\n                    }\n                });\n            });\n            strVM = strVM.replace(/\"/ig, '');\n            //console.log(strVM.substr(1));\n            var $Q = {};\n            $.map(strVM.substr(1).split(','), function (obj, index) {\n                var targetVmObject = obj.split(':');\n                //console.log(targetVmObject[0]);\n                switch (targetVmObject[0]) {\n                    case 'value':\n                        if (targetVmObject[1].indexOf('num') > -1) {\n                            $Q[targetVmObject[1]] = ko.observable(\"0\");\n                        } else {\n                            $Q[targetVmObject[1]] = ko.observable(\"\");\n                        }\n                        break;\n                    case 'checked':\n                        $Q[targetVmObject[1]] = ko.observable(false);\n                        break;\n                    case 'enable':\n                        $Q[targetVmObject[1]] = ko.observable(true);\n                        break;\n                    case 'disabled':\n                        $Q[targetVmObject[1]] = ko.observable(false);\n                        break;\n                    case 'click':\n                        $Q[targetVmObject[1]] = function () {\n                            alert('' + targetVmObject[1]) + ''\n                        };\n                        break;\n                    case 'ddlPromt':\n                        $Q[targetVmObject[1]] = ddlPromt;\n                        break;\n                }\n                ;\n            });\n            for (var Q in $Q) {\n                //console.log(Q);\n                base[Q] = $Q[Q];\n            }\n            return $Q;\n        },\n        bindViewModel = function (viewModel, $vm) {\n            for (var vm in $vm) {\n                if (viewModel[vm] == null) {\n                    viewModel[vm] = $vm[vm];\n                }\n            }\n        };\n    return {\n        loadCss: loadCss,\n        loadScript: loadScript,\n        dateStringToDate: dateStringToDate,\n        getDateTimeSTR: getDateTimeSTR,\n        getDateSTR: getDateSTR,\n        getRequest: getRequest,\n        getWH: getWH,\n        getParameterByName: getParameterByName,\n        scrollTop: scrollTop,\n        genViewModel: genViewModel,\n        bindViewModel: bindViewModel\n    };\n\n    //SS.namespace(\"SS.CommonLib\");\n    //SS.CommonLib = CommonLib;\n    //return CommonLib;\n});\n","/**\n * Created by jerryhuang on 15/7/29.\n */\ndefine('base/components/viewmodels/UICKEditor',['require','Common'],function (require) {\n    var base;\n    var common = require('Common');\n    common.loadCss([{\n        id: 'fontelloCss',\n        uri: SS.app.baseUrl + 'app/base/components/resources/css/CKEditor/fontello.css'\n    }]);\n    return {\n        init: function (id, params) {\n            base = params.viewModel;\n            //用此種require的引入方式，可以延遲引入時間\n            require(['ckeditor'], function (ckeditor) {\n                if (CKEDITOR.env.ie && CKEDITOR.env.version < 9)\n                    CKEDITOR.tools.enableHtml5Elements(document);\n\n                // The trick to keep the editor in the sample quite small\n                // unless user specified own height.\n                // CKEDITOR.config.height = 150;\n                // CKEDITOR.config.width = 'auto';\n                // console.log(base.config());\n                // CKEDITOR.config=base.config();\n                var config = base.config();\n                // config.filebrowserBrowseUrl= '/ckfinder/ckfinder.html';\n                // config.filebrowserImageBrowseUrl= '/ckfinder/ckfinder.html?type=Images';,\n                config.extraPlugins = 'uploadimage';\n                config.uploadUrl = SS.service.baseUrl + 'CKEditorUploadPhoto';\n                // config.filebrowserUploadUrl = '/ckfinder/core/connector/php/connector.php?command=QuickUpload&type=Files';\n                config.filebrowserImageUploadUrl = SS.service.baseUrl + 'CKEditorUploadPhoto';\n                for (var key in config) {\n                    CKEDITOR.config[key] = config[key];\n                }\n\n                var initSample = (function () {\n                    var wysiwygareaAvailable = isWysiwygareaAvailable(),\n                        isBBCodeBuiltIn = !!CKEDITOR.plugins.get('bbcode');\n\n                    return function () {\n                        var editorElement = CKEDITOR.document.getById(base.id());\n                        // :(((\n                        if (isBBCodeBuiltIn) {\n                            editorElement.setHtml(\n                                'Hello world!\\n\\n' +\n                                'I\\'m an instance of [url=http://ckeditor.com]CKEditor[/url].'\n                            );\n                        }\n\n                        // Depending on the wysiwygare plugin availability initialize classic or inline editor.\n                        if (wysiwygareaAvailable) {\n                            CKEDITOR.replace(base.id());\n                        } else {\n                            editorElement.setAttribute('contenteditable', 'true');\n                            CKEDITOR.inline(base.id());\n\n                            // TODO we can consider displaying some info box that\n                            // without wysiwygarea the classic editor may not work.\n                        }\n                    };\n\n                    function isWysiwygareaAvailable() {\n                        // If in development mode, then the wysiwygarea must be available.\n                        // Split REV into two strings so builder does not replace it :D.\n                        if (CKEDITOR.revision == ( '%RE' + 'V%' )) {\n                            return true;\n                        }\n\n                        return !!CKEDITOR.plugins.get('wysiwygarea');\n                    }\n\n                })();\n                initSample();\n\n                CKEDITOR.instances[base.id()].on('change', function() {\n                    // console.log(CKEDITOR.instances[base.id()].getData());\n                    base(CKEDITOR.instances[base.id()].getData());\n                });\n\n            });\n            // console.dir(base);\n            base.subscribe(function (newValue) {\n                if(newValue!=CKEDITOR.instances[base.id()].getData()){\n                    CKEDITOR.instances[base.id()].setData(newValue);\n                }\n            });\n        },\n        viewModelKeydown: function (vm, e) {\n            base = this;\n            setTimeout(function () {\n                base.viewModel.wordCount($(e.currentTarget).val().length);\n            }, 50);\n            return true;\n        }\n    };\n});\n"]}