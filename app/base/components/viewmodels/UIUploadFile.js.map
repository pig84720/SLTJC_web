{"version":3,"file":"UIUploadFile.js","sources":["../../utils/Upload.js","../../utils/PostMessage.js","../../utils/Common.js","UIUploadFile.js"],"names":[],"mappings":"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","sourcesContent":["define(\n    'Upload',[],function () {\n        var baseUrl = '',\n            setBsaeUrl = function (url) {\n                baseUrl = url;\n            },\n            doUpload = function (url, uploadId, success, failure) {\n                $.support.cors = true;\n                url = baseUrl + url;\n                //console.log(url);\n                var files = $(\"#\" + uploadId).get(0).files;\n                if (files.length > 0) {\n                    var data = new FormData();\n                    for (i = 0; i < files.length; i++) {\n                        data.append(\"file\" + i, files[i]);\n                    }\n                    $.ajax({\n                        type: \"POST\",\n                        url: url,\n                        contentType: false,\n                        processData: false,\n                        data: data,\n                        success: function (messages) {\n                            //for (i = 0; i < messages.length; i++) {\n                            //\talert(messages[i]);\n                            //}\n                            success(messages);\n                        },\n                        error: function () {\n                            //alert(\"Error while invoking the Web API\");\n                            failure();\n                        }\n                    });\n                }\n            },\n            doUploadiFrame = function (uploadFormId) {\n                var dfd1 = $.Deferred();\n\n                try {\n\n                    if ($('#uploadExcelToJsonFrame')[0] == null) {\n                        $('<iframe>', {\n                            src: 'about:blank',\n                            id: 'uploadExcelToJsonFrame',\n                            name: 'uploadExcelToJsonFrame',\n                            frameborder: 0,\n                            scrolling: 'no',\n                            width: 200,\n                            height: 200\n                        }).appendTo(uploadFormId != null ? '#' + uploadFormId : 'form');\n                    }\n\n                    $(uploadFormId != null ? '#' + uploadFormId : 'form')\n                        .attr('method', 'post')\n                        .attr('target', 'uploadExcelToJsonFrame')\n                        .attr('enctype', 'multipart/form-data')\n                        .attr('encoding', 'multipart/form-data')\n                        .attr('action', baseUrl + 'api/Excel/ExcelToJsonIE');\n\n\n                    $('#uploadExcelToJsonFrame').load(function () {\n                        SS.mask.hide();\n                        var data = $.parseJSON($(\"#uploadExcelToJsonFrame\").contents().find(\"body\").html() || '{}');\n                        dfd1.resolve(data);\n                    });\n\n                    SS.mask.show();\n                    $(uploadFormId != null ? '#' + uploadFormId : 'form').submit();\n\n                } catch (ex) {\n                    SS.mask.hide();\n                    dfd1.reject(ex);\n                }\n                return dfd1.promise();\n            },\n            transExcelToJsonOleDB = function (uploadFormId) {\n                var dfd1 = $.Deferred();\n\n                try {\n\n                    if ($('#uploadExcelToJsonFrame')[0] == null) {\n                        $('<iframe>', {\n                            src: 'about:blank',\n                            id: 'uploadExcelToJsonFrame',\n                            name: 'uploadExcelToJsonFrame',\n                            frameborder: 0,\n                            scrolling: 'no',\n                            width: 200,\n                            height: 200\n                        }).appendTo(uploadFormId != null ? '#' + uploadFormId : 'form');\n                    }\n\n                    $(uploadFormId != null ? '#' + uploadFormId : 'form')\n                        .attr('method', 'post')\n                        .attr('target', 'uploadExcelToJsonFrame')\n                        .attr('enctype', 'multipart/form-data')\n                        .attr('encoding', 'multipart/form-data')\n                        .attr('action', baseUrl + 'api/Excel/OleDBExcelToJsonIE');\n\n\n                    $('#uploadExcelToJsonFrame').load(function () {\n                        SS.mask.hide();\n                        var data = $.parseJSON($(\"#uploadExcelToJsonFrame\").contents().find(\"body\").html() || '{}');\n                        dfd1.resolve(data);\n                    });\n\n                    SS.mask.show();\n                    $(uploadFormId != null ? '#' + uploadFormId : 'form').submit();\n\n                } catch (ex) {\n                    SS.mask.hide();\n                    dfd1.reject(ex);\n                }\n                return dfd1.promise();\n            },\n            uploadFile = function (inVar) {\n                var dfd1 = $.Deferred(),\n                    uploadFrameId = 'uploadFileFrame';\n\n                try {\n                    if ($('#' + uploadFrameId)[0] == null) {\n                        $('<iframe>', {\n                            src: 'about:blank',\n                            id: uploadFrameId,\n                            name: uploadFrameId,\n                            frameborder: 0,\n                            scrolling: 'no',\n                            width: 0,\n                            height: 0\n                        }).appendTo(inVar.uploadFormId != null ? '#' + inVar.uploadFormId : 'form');\n                    }\n\n                    $(inVar.uploadFormId != null ? '#' + inVar.uploadFormId : 'form')\n                        .attr('method', 'post')\n                        .attr('target', uploadFrameId)\n                        .attr('enctype', 'multipart/form-data')\n                        .attr('encoding', 'multipart/form-data')\n                        .attr('action', baseUrl + 'api/Upload/UploadFile');\n\n                    if (!document.getElementById('uploadFileParams')) {\n                        $('#' + inVar.uploadFormId).append(\n                            '<input id=\"uploadFileParams\" ' +\n                            'name=\"uploadFileParams\" ' +\n                            'value=\\'' + JSON.stringify(inVar.uploadFileParams) + '\\' ' +\n                            'type=\"hidden\" />'\n                        );\n                    }\n\n                    $('#' + uploadFrameId).load(function () {\n                        SS.mask.hide();\n                        data = $.parseJSON($(\"#\" + uploadFrameId).contents().find(\"body\").html() || '{}');\n                        //console.log(data);\n                        dfd1.resolve(data);\n\n                    });\n\n                    SS.mask.show();\n                    $(inVar.uploadFormId != null ? '#' + inVar.uploadFormId : 'form').submit();\n\n                } catch (ex) {\n                    SS.mask.hide();\n                    dfd1.reject(ex);\n                }\n                return dfd1.promise();\n            };\n\n        var UploadLib = {\n            setBsaeUrl: setBsaeUrl,\n            doUpload: doUpload,\n            doUploadiFrame: doUploadiFrame,\n            uploadFile: uploadFile,\n            transExcelToJsonOleDB: transExcelToJsonOleDB\n        };\n\n        SS.namespace(\"SS.UploadLib\");\n        SS.UploadLib = UploadLib;\n        return UploadLib;\n    });\n","/**\n * Created by jerryhuang on 15/8/31.\n */\ndefine('PostMessage',['require'],function (require) {\n    var platform = '';\n    SS.namespace(\"SS.postMessage.callback\");\n    SS.postMessage.callback = SS.postMessage.callback || {};\n\n    var receiveMessage = function (e) {\n        //if (e.origin != iframeHost) return;\n        var data;\n        //ie8只能傳遞文字，無法傳遞物件\n        if (platform == 'ie8') {\n            data = JSON.parse(e.data);\n        } else {\n            data = e.data;\n        }\n        if (SS.postMessage.callback[data.callbackId] != null) {\n            SS.postMessage.callback[data.callbackId](data);\n            SS.postMessage.callback[data.callbackId] = null;\n        } else if (callbackFunction != null) {\n            callbackFunction(data);\n        }\n    };\n    var count = 0;\n    var callbackFunction;\n    return {\n        init: function (callback) {\n            //註冊接收訊息事件\n            if (window.addEventListener) {\n                window.addEventListener('message', receiveMessage);\n                platform = '';\n            } else if (window.attachEvent) {\n                window.attachEvent('onmessage', receiveMessage);\n                platform = 'ie8';\n            }\n            if (callback != null) {\n                callbackFunction = callback;\n            } else {\n                callbackFunction = null;\n            }\n        },\n        sendMessage: function (inVar) {\n            if (inVar.type == 'iframe' && document.getElementById(inVar.frameId) == null) return;\n            var framePage = (inVar.type == 'iframe' ? document.getElementById(inVar.frameId).contentWindow : (inVar.type == 'parent' ? window.parent : (inVar.type == 'opener' ? window.opener : null)));\n            var callbackId = inVar.callbackId != null ? inVar.callbackId : inVar.triggerFunction + (count++);\n            if (framePage) {\n                var postData = (platform == 'ie8' ? JSON.stringify({\n                    callbackId: callbackId,\n                    triggerFunction: inVar.triggerFunction,\n                    messageContent: inVar.messageContent\n                }) : {\n                    callbackId: callbackId,\n                    triggerFunction: inVar.triggerFunction,\n                    messageContent: inVar.messageContent\n                });\n                //ie8只能傳遞文字，無法傳遞物件\n                //if (platform == 'ie8') {\n                //    framePage.postMessage(postData, '*');\n                //} else {\n                    framePage.postMessage(postData, '*');\n                //}\n                SS.postMessage.callback[callbackId] = inVar.callback;\n            } else {\n                console.log('post message can\\'t find post target page!!');\n            }\n        },\n        getPlatform: function () {\n            return platform;\n        }\n    };\n});\n","define('Common',[],function () {\n    var loadCss = function (url) {\n            $.map(url, function (item, index) {\n                var link = document.createElement(\"link\");\n                link.type = \"text/css\";\n                link.rel = \"stylesheet\";\n                link.href = item.uri;\n                link.id = item.id;\n                if (item.noscript) {\n                    var noscript = document.createElement(\"noscript\");\n                    noscript.appendChild(link);\n                    document.getElementsByTagName(\"head\")[0].appendChild(noscript);\n                } else {\n                    document.getElementsByTagName(\"head\")[0].appendChild(link);\n                }\n                //console.log(link);\n            });\n        },\n        loadScript = function (url) {\n            $.map(url, function (uri, index) {\n                var scriptblock = document.createElement(\"script\");\n                scriptblock.type = \"text/javascript\";\n                scriptblock.src = uri.uri;\n                scriptblock.id = uri.id;\n                document.getElementsByTagName(\"head\")[0].appendChild(scriptblock);\n            });\n        },\n        dateStringToDate = function (dateString) {\n            try {\n                var scheduledDateArray = dateString.split('T')[0].split('-');\n                var scheduledTimeArray = dateString.split('T')[1].split(':');\n                //console.log(scheduledDateArray);\n                //console.log(scheduledTimeArray);\n                var scheduledTime = new Date(\n                    parseInt(scheduledDateArray[0]),\n                    parseInt(scheduledDateArray[1]) - 1,\n                    parseInt(scheduledDateArray[2]),\n                    parseInt(scheduledTimeArray[0]),\n                    parseInt(scheduledTimeArray[1])\n                );\n                return scheduledTime;\n            } catch (e) {\n                return null;\n            }\n        },\n        getDateTimeSTR = function (now) {\n            if (now == null) {\n                return '';\n            } else {\n                year = \"\" + now.getFullYear();\n                month = \"\" + (now.getMonth() + 1);\n                if (month.length == 1) {\n                    month = \"0\" + month;\n                }\n                day = \"\" + now.getDate();\n                if (day.length == 1) {\n                    day = \"0\" + day;\n                }\n                hour = \"\" + now.getHours();\n                if (hour.length == 1) {\n                    hour = \"0\" + hour;\n                }\n                minute = \"\" + now.getMinutes();\n                if (minute.length == 1) {\n                    minute = \"0\" + minute;\n                }\n                second = \"\" + now.getSeconds();\n                if (second.length == 1) {\n                    second = \"0\" + second;\n                }\n                return year + \"-\" + month + \"-\" + day + \" \" + hour + \":\" + minute + \":\" + second;\n            }\n        },\n    //取得傳入日期物件的字串格式\n        getDateSTR = function (now, ReplaceStr) {\n            return getDateTimeSTR(now).substr(0, 10).replace('-', ReplaceStr).replace('-', ReplaceStr);\n        },\n        getRequest = function (name) {\n            try {\n                if (name = (new RegExp('[?&]' + encodeURIComponent(name) + '=([^&]*)')).exec(location.search))\n                    return decodeURIComponent(name[1]);\n            } catch (e) {\n                return null;\n            }\n        },\n        getWH = function (unit) {\n            var width = (window.innerWidth > 0) ? window.innerWidth : screen.width;\n            var height = (window.innerHeight > 0) ? window.innerHeight : screen.height;\n            if (window.parent) {\n                width = (document.body.offsetWidth > 0) ? document.body.offsetWidth : width;\n            }\n            return {\n                width: width + unit,\n                height: height + unit\n            };\n        },\n        getParameterByName = function (name) {\n            name = name.replace(/[\\[]/, \"\\\\[\").replace(/[\\]]/, \"\\\\]\");\n            var regex = new RegExp(\"[\\\\?&]\" + name + \"=([^&#]*)\"),\n                results = regex.exec(location.search);\n            return results == null ? \"\" : decodeURIComponent(results[1].replace(/\\+/g, \" \"));\n        },\n        scrollTop = function (top) {\n            var $body = (window.opera) ? (document.compatMode == \"CSS1Compat\" ? $('html') : $('body')) : $('html,body');\n            $body.animate({\n                scrollTop: top\n            }, 2000);\n        },\n        genViewModel = function (base) {\n            var strVM = '';\n            $('[data-bind]').each(function (index, object) {\n                //console.log('{'+$(object).attr('data-bind')+'}');\n                var attrAry = $(object).attr('data-bind')\n                    .replace(/ /ig, '')\n                    .replace('jqxInput:', '')\n                    .replace('jqxDateTimeInput:', '')\n                    .replace('jqxNumberInput:', '')\n                    .replace('jqxCheckBox:', '')\n                    .replace('jqxRadioButton:', '')\n                    .replace('{', '')\n                    .replace('}', '')\n                    .split(',');\n                $.map(attrAry, function (obj, index) {\n                    //console.log(obj);\n                    var attr = obj.split(':');\n                    if (attr[0] == 'value' || attr[0] == 'enable' || attr[0] == 'disabled' || attr[0] == 'click' || attr[0] == 'ddlPromt' || attr[0] == 'checked') {\n                        if (attr[0] == 'disabled') {\n                            if (strVM.indexOf('\"' + attr[1] + '\"') == -1) {\n                                strVM += ',' + attr[0] + ':\"' + attr[1].replace('!', '') + '\"';\n                            }\n                        } else {\n                            if (strVM.indexOf('\"' + attr[1] + '\"') == -1) {\n                                strVM += ',' + attr[0] + ':\"' + attr[1] + '\"';\n                            }\n                        }\n                    }\n                });\n            });\n            strVM = strVM.replace(/\"/ig, '');\n            //console.log(strVM.substr(1));\n            var $Q = {};\n            $.map(strVM.substr(1).split(','), function (obj, index) {\n                var targetVmObject = obj.split(':');\n                //console.log(targetVmObject[0]);\n                switch (targetVmObject[0]) {\n                    case 'value':\n                        if (targetVmObject[1].indexOf('num') > -1) {\n                            $Q[targetVmObject[1]] = ko.observable(\"0\");\n                        } else {\n                            $Q[targetVmObject[1]] = ko.observable(\"\");\n                        }\n                        break;\n                    case 'checked':\n                        $Q[targetVmObject[1]] = ko.observable(false);\n                        break;\n                    case 'enable':\n                        $Q[targetVmObject[1]] = ko.observable(true);\n                        break;\n                    case 'disabled':\n                        $Q[targetVmObject[1]] = ko.observable(false);\n                        break;\n                    case 'click':\n                        $Q[targetVmObject[1]] = function () {\n                            alert('' + targetVmObject[1]) + ''\n                        };\n                        break;\n                    case 'ddlPromt':\n                        $Q[targetVmObject[1]] = ddlPromt;\n                        break;\n                }\n                ;\n            });\n            for (var Q in $Q) {\n                //console.log(Q);\n                base[Q] = $Q[Q];\n            }\n            return $Q;\n        },\n        bindViewModel = function (viewModel, $vm) {\n            for (var vm in $vm) {\n                if (viewModel[vm] == null) {\n                    viewModel[vm] = $vm[vm];\n                }\n            }\n        };\n    return {\n        loadCss: loadCss,\n        loadScript: loadScript,\n        dateStringToDate: dateStringToDate,\n        getDateTimeSTR: getDateTimeSTR,\n        getDateSTR: getDateSTR,\n        getRequest: getRequest,\n        getWH: getWH,\n        getParameterByName: getParameterByName,\n        scrollTop: scrollTop,\n        genViewModel: genViewModel,\n        bindViewModel: bindViewModel\n    };\n\n    //SS.namespace(\"SS.CommonLib\");\n    //SS.CommonLib = CommonLib;\n    //return CommonLib;\n});\n","/**\n * Created by jerryhuang on 15/7/29.\n */\ndefine('base/components/viewmodels/UIUploadFile',['require','Upload','PostMessage','Common'],function(require) {\n    var base,\n        upload = require('Upload'),\n        postMessage = require('PostMessage'),\n        uploadId = 'uploadFile',\n        common = require('Common'),\n        createUploadControl = function() {\n            if ($('#' + uploadId + 'Popup')[0] == null) {\n                var popup = '<div class=\"modal fade \" id=\"' + uploadId + 'Popup\" tabindex=\"-1\" role=\"dialog\" aria-labelledby=\"' + uploadId + 'Label\"> ' +\n                    '<div class=\"modal-dialog \" role=\"document\">' +\n                    '<div class=\"modal-content\"> ' +\n                    '<div class=\"modal-header\"> ' +\n                    '<button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\"><span aria-hidden=\"true\">&times;</span></button> ' +\n                    '<h5 class=\"modal-title\" id=\"' + uploadId + 'Label\">' + base.label() + '</h5>' +\n                    '</div> ' +\n                    '<div class=\"modal-body\"> ' +\n                    '<iframe id=\"' + uploadId + 'ParentFrame\" src=\"about:blank\" frameborder=\"0\" style=\"width:500px;height:50px;\"></iframe>' +\n                    '</div> ' +\n                    '<div class=\"modal-footer\"> ' +\n                    '<span class=\"extFileLimit\" style=\"float: left; color: red;\"></span>' +\n                    '<button type=\"button\" class=\"btn btn-default\" id=\"' + uploadId + 'Button\" >上傳檔案</button> ' +\n                    '</div> ' +\n                    '</div> ' +\n                    '</div> ' +\n                    '</div>';\n\n                $(popup).appendTo('body');\n\n                $('#' + uploadId + 'Button')\n                    .click(function() {\n                        SS.mask.show();\n                        postMessage.sendMessage({\n                            type: 'iframe',\n                            frameId: uploadId + 'ParentFrame',\n                            triggerFunction: 'uploadFile',\n                            messageContent: {\n                                baseUrl: base.serviceUrl(),\n                                extFileLimit: base.extFileLimit(),\n                                uploadFileParams: {\n                                    UploadPath: base.uploadPath(),\n                                    FileName: base.setFileName(),\n                                    iFrameFlg: 'Y'\n                                }\n                            },\n                            callback: function(data) {\n                                SS.mask.hide();\n                                //console.log(data);\n                                //base.callback(data);\n                                if (data.messageContent.result == true) {\n                                    base.callback(data.messageContent.data);\n                                    $('.close', '#' + uploadId + 'Popup').click();\n                                    $('#' + uploadId + 'ParentFrame').attr('src', base.serviceUrl() + 'proxyPage/proxyPage.html');\n                                }\n                                else {\n                                    if (data.messageContent.data != 'errorInput') {\n                                        alert('上傳檔案發生異常！');\n                                    }\n                                }\n                            }\n                        });\n                    });\n                $('#' + uploadId + 'ParentFrame').attr('src', base.serviceUrl() + 'proxyPage/proxyPage.html');\n                postMessage.init();\n            }\n\n        };\n\n    if (typeof $().modal != 'function') {\n        if ($('#bootstrapScript')[0] == null) {\n            common.loadScript([{\n                uri: SS.app.baseUrl + 'app/base/resources/scripts/bootstrap.min.js',\n                id: 'bootstrapScript'\n            }]);\n        }\n    }\n\n    return {\n        init: function(id, params) {\n            base = params.viewModel;\n            upload.setBsaeUrl(base.serviceUrl());\n            //console.log(base);\n            createUploadControl();\n        },\n        uploadFile: function(vm, e) {\n            //console.dir(arguments);\n            base = vm.viewModel;\n            $('#' + uploadId + 'Label').html(base.label());\n            $('.extFileLimit', '#' + uploadId + 'Popup .modal-footer').html('＊上傳檔案格式僅限『' + base.extFileLimit().join(', ').toLowerCase() + '』');\n            $('#' + uploadId + 'Popup').modal({\n                show: true\n            });\n        }\n    };\n});\n"]}